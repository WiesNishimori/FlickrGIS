<!doctype html>
<html lang="en">
    <head>

		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  		integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   		crossorigin=""/>

 		<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   		integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   		crossorigin=""></script>
   		<script src="data/leaflet.ajax.min.js"></script>
   		<script type="text/javascript" src="test.geojson"></script>

   		<!-- slider code -->
   		<link href="https://refreshless.com/nouislider/distribute/nouislider.css?v=1410" rel="stylesheet">
    	<script src="https://refreshless.com/nouislider/distribute/nouislider.js?v=1410"></script>


        <style>
		html, body, #mapid {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .legendslider {
            width: 90%;
            padding: 0;
            margin: 0;
            position: fixed;
  			bottom: 0;
        }
        </style> 

        <title>Paris</title>
	</head>
	<body>
		<style>
		.c-1-color { background: #E5000E; }
		.c-2-color { background: #E33842; }
		.c-3-color { background: #E27077; }
		.c-4-color { background: #E1A8AB; }
		.c-5-color { background: #E0E0E0; }

		</style>
<!-- SLIDER CODE STARTS HERE -->
		<div style="z-index: 10000" class = "legendslider">
            <div class="slider" id="slider-color" ></div>
            <input type="text" id="input1">
            <input type="text" id="input2">
            <input type="text" id="input3">
            <input type="text" id="input4">
            <button id="button1">Update</button>
        </div>
            <script>
				var slider = document.getElementById('slider-color');
				var input1 = document.getElementById('input1');
				var input2 = document.getElementById('input2');
				var input3 = document.getElementById('input3');
				var input4 = document.getElementById('input4');
				var inputs = [input1,input2,input3,input4];
				var class1 = 1000;
				var class2 = 2000;
				var class3 = 5000;
				var class4 = 10000;
				var classif = [class1,class2,class3,class4];


				noUiSlider.create(slider, {
    				start: [Math.log(class1), Math.log(class2), Math.log(class3), Math.log(class4)],
    				connect: [true, true, true, true, true],
    				range: {
        				'min': [0],
        				'max': [11.1991184213],
    				}
				});

				slider.noUiSlider.on('update', function (values, handle) {
				    inputs[handle].value = Math.round(Math.exp(values[handle]));
				    classif[handle] = Math.round(Math.exp(values[handle]));
				});
				</script>           
				<script>
				var connect = slider.querySelectorAll('.noUi-connect');
				var classes = ['c-5-color', 'c-4-color', 'c-3-color', 'c-2-color', 'c-1-color'];

				for (var i = 0; i < connect.length; i++) {
				    connect[i].classList.add(classes[i]);
				}
				</script>      

				<script>
				inputs.forEach(function (input, handle) {
				    input.addEventListener('change', function () {
				        slider.noUiSlider.setHandle(handle, Math.log(this.value));
				        classif[handle] = parseInt(this.value);
				    });

				});
				</script>
        <div id="mapid" > </div>

        <script>

			var mymap = L.map('mapid').setView([48.861989576315885,2.3193358726491717], 13);


			L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			maxZoom: 18,
			minZoom: 12,

			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox/streets-v11'
			}).addTo(mymap);
	
			//var geojson = L.geoJson(hex).addTo(mymap);
			var geojson = L.geoJson(hex, {
    			style: style,
    		}).addTo(mymap);
/*
			function getColor(d) {
    		return 	d >  20000 ? '#E5000E' :
           			d > 5000 ? '#E33842' :
           			d > 2000 ? '#E27077' :
           			d > 1000 ? '#E1A8AB' :
                 				'#E0E0E0';
			}; */

			function getColor(d) {
    		return 	d > classif[3] ? '#E5000E' :
           			d > classif[2] ? '#E33842' :
           			d > classif[1] ? '#E27077' :
           			d > classif[0] ? '#E1A8AB' :
                 				'#E0E0E0';
			}; 


			function style(feature) {
    		return {
        			fillColor: getColor(feature.properties.pic),
        			weight: 0.05,
        			opacity: 1,
        			color: 'white',
        			dashArray: '3',
        			fillOpacity: 0.5
    		};
    		}
    		/*
    		function doStuff() {
   				console.log(classif);
   				console.log(classif[3]);
   				setTimeout(doStuff, 2000);
			}
			setTimeout(doStuff, 2000); */
			
			button1.addEventListener("click", function(){
			 
			  	console.log("button1 was clicked"); 
			  	geojson.eachLayer(function(layer){
			  		var pic = layer.feature.properties.pic; 
					layer.setStyle(style(layer.feature));
				}); 
   
			});

    		//var geojson = L.geoJson(hex, {
    			//style: style,
    		//}).addTo(mymap);
    		
			

		</script>
	</body>
</html>